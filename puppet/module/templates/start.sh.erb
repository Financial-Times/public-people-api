#!/bin/bash

cd <%= @install_dir %>
<%= @binary_file %> <%= @service_args %> 2>&1 >> <%= @startup_log_file %> &

count=0
while [[ ! $(curl -s -o /dev/null -w "%{http_code}" <%= @status_check_url %> | grep 200) ]]; do
    sleep 1
    let count++
    if [[ ${count} == <%= @startup_timeout %> ]]; then
        echo "Startup failed. Could not get a 200 from <%= @status_check_url %> after 20 seconds." >> <%= @startup_log_file %>
        exit 1
    fi
done

exit 0
